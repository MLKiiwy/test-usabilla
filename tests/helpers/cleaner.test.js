import cleaner from '../../src/helpers/cleaner';

describe('helpers.cleaner', () => {
  it('should clean the input, and return only usefull fields flattened', () => {
    const input = {
      items: [
        {
          browser: {
            onLine: true,
            product: 'Gecko',
            appCodeName: 'Mozilla',
            userAgent:
              'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.102 Safari/537.36',
            platform: 'MacIntel',
            appVersion:
              '5.0 (Macintosh; Intel Mac OS X 10_8_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.102 Safari/537.36',
            appName: 'Netscape',
            vendorSub: '',
            vendor: 'Google Inc.',
            productSub: '20030107',
            cookieEnabled: true,
            language: 'fr',
          },
          campaign: [],
          comment: 'belle offre de services',
          computed_browser: {
            Browser: 'Chrome',
            Version: '32.0',
            Platform: 'MacOSX',
            FullBrowser: 'Chrome',
          },
          computed_location: 'France',
          creation_date: 1391445344,
          custom: {
            subject: 'compliment',
          },
          email: 'nicolas@usabilla.com',
          geo: {
            country: 'FR',
            region: 'A8',
            city: 'Paris',
            lat: 48.8667,
            lon: 2.3333,
          },
          host: 'https://usabilla.com',
          html_snippet: null,
          images: {
            screenshot: {
              uri: '52efc552b6679cfe6ede406c/screenshot',
              width: 1583,
              height: 1835,
              url: '//usabilla-feedback-live.s3.amazonaws.com/52efc552b6679cfe6ede406c/screenshot',
            },
            thumbnail: {
              uri: '52efc552b6679cfe6ede406c/thumbnail',
              width: 66,
              height: 66,
              url: '//usabilla-feedback-live.s3.amazonaws.com/52efc552b6679cfe6ede406c/thumbnail',
            },
            cropped: {
              uri: '52efc552b6679cfe6ede406c/cropped',
              width: 470,
              height: 430,
              url: '//usabilla-feedback-live.s3.amazonaws.com/52efc552b6679cfe6ede406c/cropped',
            },
            grid: {
              uri: '52efc552b6679cfe6ede406c/grid',
              width: 218,
              height: 152,
              url: '//usabilla-feedback-live.s3.amazonaws.com/52efc552b6679cfe6ede406c/grid',
            },
            list: {
              uri: '52efc552b6679cfe6ede406c/list',
              width: 48,
              height: 48,
              url: '//usabilla-feedback-live.s3.amazonaws.com/52efc552b6679cfe6ede406c/list',
            },
            detail: {
              uri: '52efc552b6679cfe6ede406c/detail',
              width: 258,
              height: 300,
              url: '//usabilla-feedback-live.s3.amazonaws.com/52efc552b6679cfe6ede406c/detail',
            },
          },
          integrations_sent: {
            desk: 1,
          },
          ip: 'xx.xx.xx.xx',
          labels: ['compliment'],
          nps: null,
          original_size: [],
          performance: 3,
          public_id: 'b7d11c1beed52fc80d4df09d761b332aaaa9be64',
          rating: 5,
          screen: {
            availWidth: 1440,
            availHeight: 874,
            availTop: 22,
            availLeft: 0,
            pixelDepth: 24,
            colorDepth: 24,
            width: 1440,
            height: 900,
          },
          site_id: '65faae774973',
          status: 'new',
          tags: [],
          timing: {
            loadEventEnd: 1391444512508,
            loadEventStart: 1391444512495,
            domComplete: 1391444512495,
            domContentLoadedEventEnd: 1391444472165,
            domContentLoadedEventStart: 1391444472154,
            domInteractive: 1391444472154,
            domLoading: 1391444472081,
            responseEnd: 1391444472072,
            responseStart: 1391444472071,
            requestStart: 1391444471608,
            secureConnectionStart: 0,
            connectEnd: 1391444471606,
            connectStart: 1391444471606,
            domainLookupEnd: 1391444471606,
            domainLookupStart: 1391444471606,
            fetchStart: 1391444471606,
            redirectEnd: 0,
            redirectStart: 0,
            unloadEventEnd: 1391444472073,
            unloadEventStart: 1391444472073,
            navigationStart: 1391444471606,
          },
          url: 'https://usabilla.com/',
          viewport: {
            width: 1583,
            height: 865,
          },
          id: '52efc552b6679cfe6ede406c',
          starred: false,
        },
        {
          browser: {
            onLine: true,
            product: 'Gecko',
            appCodeName: 'Mozilla',
            userAgent:
              'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.102 Safari/537.36',
            platform: 'MacIntel',
            appVersion:
              '5.0 (Macintosh; Intel Mac OS X 10_8_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.102 Safari/537.36',
            appName: 'Netscape',
            vendorSub: '',
            vendor: 'Google Inc.',
            productSub: '20030107',
            cookieEnabled: true,
            language: 'fr',
          },
          campaign: [],
          comment: 'bouton ne fonctionne pas',
          computed_browser: {
            Browser: 'Chrome',
            Version: '32.0',
            Platform: 'MacOSX',
            FullBrowser: 'Chrome',
          },
          computed_location: 'France',
          creation_date: 1391445293,
          custom: {
            subject: 'bug',
          },
          email: 'someone@somewhere.com',
          geo: {
            country: 'FR',
            region: 'A8',
            city: 'Paris',
            lat: 48.8667,
            lon: 2.3333,
          },
          host: 'https://usabilla.com',
          html_snippet:
            '<article>\n    <h1 class="">A new standard in user feedback.</h1>\n    <h2 class="">Ask your visitors what they think and feel. Increase your conversion based on rich, visual user feedback.</h2>\n    <h2 class="">20 000+ customers worldwide already benefit from Usabilla. Now itâ€™s your turn!</h2>\n    <a class="video_box iframe" href="//www.youtube.com/embed/DXFZvv7vnWU?autoplay=1&amp;rel=0&amp;fs=0&amp;showinfo=0&amp;controls=1&amp;hd=1&amp;wmode=transparent"></a>\n\n    <div class="">\n                    <a href="/plans" class="btn_signup click_cta_homepage" title="Start your free trial">Start your free trial</a>\n                    <p class="">Interested in Enterprise features? <a class="enterprise_demo contactus" href="/contact" title="Contact us to request a live product demo by one of our representatives">Request a demo</a>.</p>\n    </div>\n</article>',
          images: {
            screenshot: {
              uri: '52efc51fb6679c986b24c7bd/screenshot',
              width: 1583,
              height: 1835,
              url: '//usabilla-feedback-live.s3.amazonaws.com/52efc51fb6679c986b24c7bd/screenshot',
            },
            full_image: {
              uri: '52efc51fb6679c986b24c7bd/full_image',
              width: 1040,
              height: 585,
              url: '//usabilla-feedback-live.s3.amazonaws.com/52efc51fb6679c986b24c7bd/full_image',
            },
            no_context: {
              uri: '52efc51fb6679c986b24c7bd/no_context',
              width: 940,
              height: 485,
              url: '//usabilla-feedback-live.s3.amazonaws.com/52efc51fb6679c986b24c7bd/no_context',
            },
            thumbnail: {
              uri: '52efc51fb6679c986b24c7bd/thumbnail',
              width: 66,
              height: 66,
              url: '//usabilla-feedback-live.s3.amazonaws.com/52efc51fb6679c986b24c7bd/thumbnail',
            },
            cropped: {
              uri: '52efc51fb6679c986b24c7bd/cropped',
              width: 470,
              height: 430,
              url: '//usabilla-feedback-live.s3.amazonaws.com/52efc51fb6679c986b24c7bd/cropped',
            },
            grid: {
              uri: '52efc51fb6679c986b24c7bd/grid',
              width: 218,
              height: 152,
              url: '//usabilla-feedback-live.s3.amazonaws.com/52efc51fb6679c986b24c7bd/grid',
            },
            list: {
              uri: '52efc51fb6679c986b24c7bd/list',
              width: 48,
              height: 48,
              url: '//usabilla-feedback-live.s3.amazonaws.com/52efc51fb6679c986b24c7bd/list',
            },
            detail: {
              uri: '52efc51fb6679c986b24c7bd/detail',
              width: 533,
              height: 300,
              url: '//usabilla-feedback-live.s3.amazonaws.com/52efc51fb6679c986b24c7bd/detail',
            },
          },
          integrations_sent: {
            webhook: 1,
          },
          ip: 'xx.xx.xx.xx',
          labels: ['bug'],
          nps: null,
          original_size: {
            width: 940,
            height: 451,
          },
          performance: 3,
          public_id: 'd0a40d196ef53fcea4782723739ad03b6b60ce7f',
          rating: 2,
          screen: {
            availWidth: 1440,
            availHeight: 874,
            availTop: 22,
            availLeft: 0,
            pixelDepth: 24,
            colorDepth: 24,
            width: 1440,
            height: 900,
          },
          site_id: '65faae774973',
          status: 'new',
          tags: [],
          timing: {
            loadEventEnd: 1391444512508,
            loadEventStart: 1391444512495,
            domComplete: 1391444512495,
            domContentLoadedEventEnd: 1391444472165,
            domContentLoadedEventStart: 1391444472154,
            domInteractive: 1391444472154,
            domLoading: 1391444472081,
            responseEnd: 1391444472072,
            responseStart: 1391444472071,
            requestStart: 1391444471608,
            secureConnectionStart: 0,
            connectEnd: 1391444471606,
            connectStart: 1391444471606,
            domainLookupEnd: 1391444471606,
            domainLookupStart: 1391444471606,
            fetchStart: 1391444471606,
            redirectEnd: 0,
            redirectStart: 0,
            unloadEventEnd: 1391444472073,
            unloadEventStart: 1391444472073,
            navigationStart: 1391444471606,
          },
          url: 'https://usabilla.com/',
          viewport: {
            width: 1583,
            height: 865,
          },
          id: '52efc51fb6679c986b24c7bd',
          starred: false,
        },
        {
          browser: {
            onLine: true,
            product: 'Gecko',
            appCodeName: 'Mozilla',
            userAgent:
              'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36',
            platform: 'MacIntel',
            appVersion:
              '5.0 (Macintosh; Intel Mac OS X 10_8_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36',
            appName: 'Netscape',
            vendorSub: '',
            vendor: 'Google Inc.',
            productSub: '20030107',
            cookieEnabled: true,
            language: 'en-US',
          },
          campaign: [],
          comment: 'new layout awesome',
          computed_browser: {
            Browser: 'Chrome',
            Version: '32.0',
            Platform: 'MacOSX',
            FullBrowser: 'Chrome',
          },
          computed_location: 'Netherlands',
          creation_date: 1391445225,
          custom: {
            subject: 'compliment',
          },
          email: null,
          geo: {
            country: 'NL',
            region: '07',
            city: 'Amsterdam',
            lat: 52.35,
            lon: 4.9167,
          },
          host: 'https://usabilla.com',
          html_snippet: null,
          images: {
            screenshot: {
              uri: '52efc4dcfa8d1bda61ec1c64/screenshot',
              width: 1425,
              height: 1835,
              url: '//usabilla-feedback-live.s3.amazonaws.com/52efc4dcfa8d1bda61ec1c64/screenshot',
            },
            thumbnail: {
              uri: '52efc4dcfa8d1bda61ec1c64/thumbnail',
              width: 66,
              height: 66,
              url: '//usabilla-feedback-live.s3.amazonaws.com/52efc4dcfa8d1bda61ec1c64/thumbnail',
            },
            cropped: {
              uri: '52efc4dcfa8d1bda61ec1c64/cropped',
              width: 470,
              height: 430,
              url: '//usabilla-feedback-live.s3.amazonaws.com/52efc4dcfa8d1bda61ec1c64/cropped',
            },
            grid: {
              uri: '52efc4dcfa8d1bda61ec1c64/grid',
              width: 218,
              height: 152,
              url: '//usabilla-feedback-live.s3.amazonaws.com/52efc4dcfa8d1bda61ec1c64/grid',
            },
            list: {
              uri: '52efc4dcfa8d1bda61ec1c64/list',
              width: 48,
              height: 48,
              url: '//usabilla-feedback-live.s3.amazonaws.com/52efc4dcfa8d1bda61ec1c64/list',
            },
            detail: {
              uri: '52efc4dcfa8d1bda61ec1c64/detail',
              width: 232,
              height: 300,
              url: '//usabilla-feedback-live.s3.amazonaws.com/52efc4dcfa8d1bda61ec1c64/detail',
            },
          },
          ip: 'xx.xx.xx.xx',
          labels: ['compliment'],
          nps: null,
          original_size: [],
          performance: 2,
          public_id: '0529dfc916a188a7dfa61e61c9f4f05bb28e4992',
          rating: 4,
          screen: {
            availWidth: 1440,
            availHeight: 874,
            availTop: 22,
            availLeft: 0,
            pixelDepth: 24,
            colorDepth: 24,
            width: 1440,
            height: 900,
          },
          site_id: '65faae774973',
          status: 'new',
          tags: [],
          timing: {
            loadEventEnd: 1391444510905,
            loadEventStart: 1391444510887,
            domComplete: 1391444510886,
            domContentLoadedEventEnd: 1391444509846,
            domContentLoadedEventStart: 1391444509820,
            domInteractive: 1391444509820,
            domLoading: 1391444509273,
            responseEnd: 1391444509282,
            responseStart: 1391444509264,
            requestStart: 1391444509067,
            secureConnectionStart: 1391444508814,
            connectEnd: 1391444509067,
            connectStart: 1391444508683,
            domainLookupEnd: 1391444508683,
            domainLookupStart: 1391444508522,
            fetchStart: 1391444508520,
            redirectEnd: 0,
            redirectStart: 0,
            unloadEventEnd: 1391444509266,
            unloadEventStart: 1391444509266,
            navigationStart: 1391444508520,
          },
          url: 'https://usabilla.com/',
          viewport: {
            width: 1425,
            height: 802,
          },
          id: '52efc4dcfa8d1bda61ec1c64',
          starred: false,
        },
      ],
    };

    const output = [
      {
        comment: 'belle offre de services',
        browser: 'Chrome 32.0',
        platform: 'MacOSX',
        rating: 5,
        device: 'Desktop',
        id: '52efc552b6679cfe6ede406c',
      },
      {
        comment: 'bouton ne fonctionne pas',
        browser: 'Chrome 32.0',
        platform: 'MacOSX',
        rating: 2,
        device: 'Webhook',
        id: '52efc51fb6679c986b24c7bd',
      },
      {
        comment: 'new layout awesome',
        browser: 'Chrome 32.0',
        platform: 'MacOSX',
        rating: 4,
        device: 'Unknow',
        id: '52efc4dcfa8d1bda61ec1c64',
      },
    ];

    expect(cleaner(input)).toEqual(output);
  });
});
